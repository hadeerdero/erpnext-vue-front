{"ast":null,"code":"import \"core-js/modules/es.iterator.constructor.js\";\nimport \"core-js/modules/es.iterator.for-each.js\";\nimport \"core-js/modules/es.iterator.reduce.js\";\n// import { axiosAuth } from \"@/plugins/axios/axiosAuth\";\n\n// const state = {\n//   user: JSON.parse(localStorage.getItem(\"user\")) || null,\n//   status: \"\", // 'loading', 'success', 'error'\n//   home_page: \"/app/home\", // Default home page\n// };\n\n// const getters = {\n//   isAuthenticated: (state) => !!state.user,\n//   authStatus: (state) => state.status,\n//   currentUser: (state) => state.user,\n//   homePage: (state) => state.home_page,\n//   fullName: (state) => state.user?.full_name || null,\n// };\n\n// const mutations = {\n//   AUTH_REQUEST(state) {\n//     state.status = \"loading\";\n//   },\n//   AUTH_SUCCESS(state, { full_name, home_page }) {\n//     state.status = \"success\";\n//     state.user = {\n//       full_name: full_name,\n//     };\n//     state.home_page = home_page || \"/app/home\";\n\n//     // Persist in localStorage\n//     localStorage.setItem(\"user\", JSON.stringify(state.user));\n//     localStorage.setItem(\"home_page\", state.home_page);\n//   },\n//   AUTH_ERROR(state) {\n//     state.status = \"error\";\n//     state.user = null;\n//     localStorage.removeItem(\"user\");\n//     localStorage.removeItem(\"home_page\");\n//   },\n//   LOGOUT(state) {\n//     state.user = null;\n//     state.home_page = \"/app/home\";\n//     localStorage.removeItem(\"user\");\n//     localStorage.removeItem(\"home_page\");\n//   },\n// };\n\n// const actions = {\n//   async login({ commit }, credentials) {\n//     commit(\"AUTH_REQUEST\");\n\n//     try {\n//       const response = await axiosAuth.post(\"/api/method/login\", {\n//         usr: credentials.email,\n//         pwd: credentials.password,\n//       });\n\n//       const { full_name, home_page } = response.data;\n\n//       commit(\"AUTH_SUCCESS\", { \n//         full_name, \n//         home_page: home_page || \"/app/home\" \n//       });\n\n//       return response.data;\n//     } catch (error) {\n//       commit(\"AUTH_ERROR\");\n//       throw error;\n//     }\n//   },\n\n//   async logout({ commit }) {\n//     try {\n//       await axiosAuth.post(\"/api/method/frappe.auth.logout\");\n//     } finally {\n//       commit(\"LOGOUT\");\n//     }\n//   },\n// };\n\n// export default {\n//   namespaced: true,\n//   state,\n//   getters,\n//   mutations,\n//   actions,\n// };\n\n// src/store/modules/auth.js\n// import { axiosAuth } from \"@/plugins/axios/axiosAuth\";\n\n// const state = {\n//   user: JSON.parse(localStorage.getItem(\"user\")) || null,\n//   token: localStorage.getItem(\"token\") || null,\n//   status: \"\", // 'loading', 'success', 'error'\n//   home_page: \"/app/home\", // Default home page\n// };\n\n// const getters = {\n//   isAuthenticated: (state) => !!state.token,\n//   authStatus: (state) => state.status,\n//   currentUser: (state) => state.user,\n//   homePage: (state) => state.home_page,\n//   fullName: (state) => state.user?.full_name || null,\n//   authToken: (state) => state.token,\n// };\n\n// const mutations = {\n//   AUTH_REQUEST(state) {\n//     state.status = \"loading\";\n//   },\n//   AUTH_SUCCESS(state, { user, token, home_page }) {\n//     state.status = \"success\";\n//     state.user = user;\n//     state.token = token;\n//     state.home_page = home_page || \"/app/home\";\n\n//     // Persist in localStorage\n//     localStorage.setItem(\"user\", JSON.stringify(user));\n//     localStorage.setItem(\"token\", token);\n//     localStorage.setItem(\"home_page\", state.home_page);\n//   },\n//   AUTH_ERROR(state) {\n//     state.status = \"error\";\n//     state.user = null;\n//     state.token = null;\n//     localStorage.removeItem(\"user\");\n//     localStorage.removeItem(\"token\");\n//     localStorage.removeItem(\"home_page\");\n//   },\n//   LOGOUT(state) {\n//     state.user = null;\n//     state.token = null;\n//     state.home_page = \"/app/home\";\n//     localStorage.removeItem(\"user\");\n//     localStorage.removeItem(\"token\");\n//     localStorage.removeItem(\"home_page\");\n//   },\n// };\n\n// const actions = {\n//   async login({ commit }, credentials) {\n//     commit(\"AUTH_REQUEST\");\n\n//     try {\n//       const response = await axiosAuth.post(\"/api/method/login\", {\n//         usr: credentials.email,\n//         pwd: credentials.password,\n//       });\n\n//       // ERPNext returns the full_name in the response\n//       const user = {\n//         full_name: response.data.full_name,\n//         email: credentials.email\n//       };\n\n//       // ERPNext returns the token in the response\n//       const token = response.data.token || response.data.api_key;\n\n//       commit(\"AUTH_SUCCESS\", { \n//         user,\n//         token,\n//         home_page: response.data.home_page || \"/app/home\" \n//       });\n\n//       return response.data;\n//     } catch (error) {\n//       commit(\"AUTH_ERROR\");\n//       throw error;\n//     }\n//   },\n\n//   async logout({ commit }) {\n//     try {\n//       await axiosAuth.post(\"/api/method/logout\");\n//     } catch (error) {\n//       console.error(\"Logout error:\", error);\n//     } finally {\n//       commit(\"LOGOUT\");\n//     }\n//   },\n\n//   async verifyToken({ state }) {\n//     if (!state.token) return false;\n\n//     try {\n//       const response = await axiosAuth.get(\"/api/method/frappe.auth.get_logged_user\");\n//       return !!response.data;\n//     } catch (error) {\n//       return false;\n//     }\n//   }\n// };\n\n// export default {\n//   namespaced: true,\n//   state,\n//   getters,\n//   mutations,\n//   actions,\n// };\n\n// src/store/modules/auth.js\nimport { axiosAuth } from \"@/plugins/axios/axiosAuth\";\nconst state = {\n  user: JSON.parse(localStorage.getItem(\"user\")) || null,\n  status: \"\",\n  // 'loading', 'success', 'error'\n  home_page: localStorage.getItem(\"home_page\") || \"/app/home\"\n};\nconst getters = {\n  isAuthenticated: state => !!state.user,\n  authStatus: state => state.status,\n  currentUser: state => state.user,\n  homePage: state => state.home_page,\n  fullName: state => state.user?.full_name || null\n};\nconst mutations = {\n  AUTH_REQUEST(state) {\n    state.status = \"loading\";\n  },\n  AUTH_SUCCESS(state, {\n    user,\n    home_page\n  }) {\n    state.status = \"success\";\n    state.user = user;\n    state.home_page = home_page || \"/app/home\";\n    localStorage.setItem(\"user\", JSON.stringify(user));\n    localStorage.setItem(\"home_page\", state.home_page);\n  },\n  AUTH_ERROR(state) {\n    state.status = \"error\";\n    state.user = null;\n    localStorage.removeItem(\"user\");\n    localStorage.removeItem(\"home_page\");\n  },\n  LOGOUT(state) {\n    state.user = null;\n    state.home_page = \"/app/home\";\n    localStorage.removeItem(\"user\");\n    localStorage.removeItem(\"home_page\");\n  }\n};\nconst actions = {\n  // async login({ commit }, credentials) {\n  //   commit(\"AUTH_REQUEST\");\n\n  //   try {\n  //     // 1. Make login request - this sets the session cookie\n  //   const response =   await axiosAuth.post(\"/api/method/login\", {\n  //       usr: credentials.email,\n  //       pwd: credentials.password,\n  //     });\n\n  //     const user = {\n  //       full_name:  response.full_name,\n  //       email: credentials.email,\n  //     };\n\n  //     commit(\"AUTH_SUCCESS\", {\n  //       user,\n  //       home_page: \"/app/home\"\n  //     });\n\n  //     return user;\n  //   } catch (error) {\n  //     commit(\"AUTH_ERROR\");\n\n  //     let errorMessage = \"Login failed\";\n  //     if (error.response) {\n  //       if (error.response.data && error.response.data.message) {\n  //         errorMessage = typeof error.response.data.message === 'string' \n  //           ? error.response.data.message\n  //           : error.response.data.message.error || errorMessage;\n  //       } else if (error.response.status === 401) {\n  //         errorMessage = \"Invalid email or password\";\n  //       }\n  //     }\n\n  //     throw new Error(errorMessage);\n  //   }\n  // },\n\n  async login({\n    commit\n  }, credentials) {\n    commit(\"AUTH_REQUEST\");\n    try {\n      // 1. Clear existing cookies first (avoid conflicts)\n      document.cookie.split(\";\").forEach(cookie => {\n        const [name] = cookie.trim().split(\"=\");\n        document.cookie = `${name}=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;`;\n      });\n\n      // 2. Make login request - this sets session cookies in response\n      const response = await axiosAuth.post(\"/api/method/login\", {\n        usr: credentials.email,\n        pwd: credentials.password\n      }, {\n        withCredentials: true,\n        // Ensure cookies are received\n        headers: {\n          'X-Frappe-Site-Name': 'mynewsite.local'\n        }\n      });\n\n      // 3. Verify session by fetching user details\n      const userResponse = await axiosAuth.get(\"/api/method/frappe.auth.get_logged_user\", {\n        withCredentials: true\n      });\n\n      // 4. Extract critical cookies from document.cookie\n      const cookies = document.cookie.split(';').reduce((cookies, item) => {\n        const [name, value] = item.trim().split('=');\n        cookies[name] = value;\n        return cookies;\n      }, {});\n\n      // 5. Store user data with session verification\n      const user = {\n        full_name: userResponse.data.message.full_name,\n        email: credentials.email,\n        session_cookies: {\n          // Store critical cookies for API calls\n          sid: cookies.sid,\n          system_user: cookies.system_user,\n          user_id: cookies.user_id\n        }\n      };\n      commit(\"AUTH_SUCCESS\", {\n        user,\n        home_page: response.data.home_page || \"/app/home\"\n      });\n\n      // 6. Configure axiosAuth to use these cookies\n      axiosAuth.interceptors.request.use(config => {\n        if (cookies.sid) {\n          config.headers['Cookie'] = `sid=${cookies.sid}; system_user=${cookies.system_user}; user_id=${cookies.user_id}`;\n        }\n        return config;\n      });\n      return user;\n    } catch (error) {\n      commit(\"AUTH_ERROR\");\n      let errorMessage = \"Login failed\";\n      if (error.response) {\n        if (error.response.data?.exc_type === \"AuthenticationError\") {\n          errorMessage = \"Invalid credentials\";\n        } else {\n          errorMessage = error.response.data?.message?.message || error.response.data?.message || \"Login error occurred\";\n        }\n      }\n      throw new Error(errorMessage);\n    }\n  },\n  async logout({\n    commit\n  }) {\n    try {\n      await axiosAuth.post(\"/api/method/logout\");\n    } catch (error) {\n      console.error(\"Logout error:\", error);\n    } finally {\n      commit(\"LOGOUT\");\n    }\n  },\n  async verifyAuth({\n    state,\n    commit\n  }) {\n    try {\n      const response = await axiosAuth.get(\"/api/method/frappe.auth.get_logged_user\");\n      if (response.data && response.data.message) {\n        // Update user data if needed\n        const userData = response.data.message;\n        const updatedUser = {\n          ...state.user,\n          full_name: userData.full_name || state.user?.full_name,\n          user_image: userData.user_image || state.user?.user_image\n        };\n        commit(\"AUTH_SUCCESS\", {\n          user: updatedUser,\n          home_page: state.home_page\n        });\n        return true;\n      }\n      return false;\n    } catch (error) {\n      if (error.response && error.response.status === 401) {\n        commit(\"LOGOUT\");\n      }\n      return false;\n    }\n  }\n};\nexport default {\n  namespaced: true,\n  state,\n  getters,\n  mutations,\n  actions\n};","map":{"version":3,"names":["axiosAuth","state","user","JSON","parse","localStorage","getItem","status","home_page","getters","isAuthenticated","authStatus","currentUser","homePage","fullName","full_name","mutations","AUTH_REQUEST","AUTH_SUCCESS","setItem","stringify","AUTH_ERROR","removeItem","LOGOUT","actions","login","commit","credentials","document","cookie","split","forEach","name","trim","response","post","usr","email","pwd","password","withCredentials","headers","userResponse","get","cookies","reduce","item","value","data","message","session_cookies","sid","system_user","user_id","interceptors","request","use","config","error","errorMessage","exc_type","Error","logout","console","verifyAuth","userData","updatedUser","user_image","namespaced"],"sources":["D:/hadeerwork/erpnext-vue-front/src/store/modules/auth/auth.js"],"sourcesContent":["\r\n// import { axiosAuth } from \"@/plugins/axios/axiosAuth\";\r\n\r\n// const state = {\r\n//   user: JSON.parse(localStorage.getItem(\"user\")) || null,\r\n//   status: \"\", // 'loading', 'success', 'error'\r\n//   home_page: \"/app/home\", // Default home page\r\n// };\r\n\r\n// const getters = {\r\n//   isAuthenticated: (state) => !!state.user,\r\n//   authStatus: (state) => state.status,\r\n//   currentUser: (state) => state.user,\r\n//   homePage: (state) => state.home_page,\r\n//   fullName: (state) => state.user?.full_name || null,\r\n// };\r\n\r\n// const mutations = {\r\n//   AUTH_REQUEST(state) {\r\n//     state.status = \"loading\";\r\n//   },\r\n//   AUTH_SUCCESS(state, { full_name, home_page }) {\r\n//     state.status = \"success\";\r\n//     state.user = {\r\n//       full_name: full_name,\r\n//     };\r\n//     state.home_page = home_page || \"/app/home\";\r\n\r\n//     // Persist in localStorage\r\n//     localStorage.setItem(\"user\", JSON.stringify(state.user));\r\n//     localStorage.setItem(\"home_page\", state.home_page);\r\n//   },\r\n//   AUTH_ERROR(state) {\r\n//     state.status = \"error\";\r\n//     state.user = null;\r\n//     localStorage.removeItem(\"user\");\r\n//     localStorage.removeItem(\"home_page\");\r\n//   },\r\n//   LOGOUT(state) {\r\n//     state.user = null;\r\n//     state.home_page = \"/app/home\";\r\n//     localStorage.removeItem(\"user\");\r\n//     localStorage.removeItem(\"home_page\");\r\n//   },\r\n// };\r\n\r\n// const actions = {\r\n//   async login({ commit }, credentials) {\r\n//     commit(\"AUTH_REQUEST\");\r\n\r\n//     try {\r\n//       const response = await axiosAuth.post(\"/api/method/login\", {\r\n//         usr: credentials.email,\r\n//         pwd: credentials.password,\r\n//       });\r\n\r\n//       const { full_name, home_page } = response.data;\r\n\r\n//       commit(\"AUTH_SUCCESS\", { \r\n//         full_name, \r\n//         home_page: home_page || \"/app/home\" \r\n//       });\r\n\r\n//       return response.data;\r\n//     } catch (error) {\r\n//       commit(\"AUTH_ERROR\");\r\n//       throw error;\r\n//     }\r\n//   },\r\n\r\n//   async logout({ commit }) {\r\n//     try {\r\n//       await axiosAuth.post(\"/api/method/frappe.auth.logout\");\r\n//     } finally {\r\n//       commit(\"LOGOUT\");\r\n//     }\r\n//   },\r\n// };\r\n\r\n// export default {\r\n//   namespaced: true,\r\n//   state,\r\n//   getters,\r\n//   mutations,\r\n//   actions,\r\n// };\r\n\r\n\r\n// src/store/modules/auth.js\r\n// import { axiosAuth } from \"@/plugins/axios/axiosAuth\";\r\n\r\n// const state = {\r\n//   user: JSON.parse(localStorage.getItem(\"user\")) || null,\r\n//   token: localStorage.getItem(\"token\") || null,\r\n//   status: \"\", // 'loading', 'success', 'error'\r\n//   home_page: \"/app/home\", // Default home page\r\n// };\r\n\r\n// const getters = {\r\n//   isAuthenticated: (state) => !!state.token,\r\n//   authStatus: (state) => state.status,\r\n//   currentUser: (state) => state.user,\r\n//   homePage: (state) => state.home_page,\r\n//   fullName: (state) => state.user?.full_name || null,\r\n//   authToken: (state) => state.token,\r\n// };\r\n\r\n// const mutations = {\r\n//   AUTH_REQUEST(state) {\r\n//     state.status = \"loading\";\r\n//   },\r\n//   AUTH_SUCCESS(state, { user, token, home_page }) {\r\n//     state.status = \"success\";\r\n//     state.user = user;\r\n//     state.token = token;\r\n//     state.home_page = home_page || \"/app/home\";\r\n\r\n//     // Persist in localStorage\r\n//     localStorage.setItem(\"user\", JSON.stringify(user));\r\n//     localStorage.setItem(\"token\", token);\r\n//     localStorage.setItem(\"home_page\", state.home_page);\r\n//   },\r\n//   AUTH_ERROR(state) {\r\n//     state.status = \"error\";\r\n//     state.user = null;\r\n//     state.token = null;\r\n//     localStorage.removeItem(\"user\");\r\n//     localStorage.removeItem(\"token\");\r\n//     localStorage.removeItem(\"home_page\");\r\n//   },\r\n//   LOGOUT(state) {\r\n//     state.user = null;\r\n//     state.token = null;\r\n//     state.home_page = \"/app/home\";\r\n//     localStorage.removeItem(\"user\");\r\n//     localStorage.removeItem(\"token\");\r\n//     localStorage.removeItem(\"home_page\");\r\n//   },\r\n// };\r\n\r\n// const actions = {\r\n//   async login({ commit }, credentials) {\r\n//     commit(\"AUTH_REQUEST\");\r\n\r\n//     try {\r\n//       const response = await axiosAuth.post(\"/api/method/login\", {\r\n//         usr: credentials.email,\r\n//         pwd: credentials.password,\r\n//       });\r\n\r\n//       // ERPNext returns the full_name in the response\r\n//       const user = {\r\n//         full_name: response.data.full_name,\r\n//         email: credentials.email\r\n//       };\r\n\r\n//       // ERPNext returns the token in the response\r\n//       const token = response.data.token || response.data.api_key;\r\n\r\n//       commit(\"AUTH_SUCCESS\", { \r\n//         user,\r\n//         token,\r\n//         home_page: response.data.home_page || \"/app/home\" \r\n//       });\r\n\r\n//       return response.data;\r\n//     } catch (error) {\r\n//       commit(\"AUTH_ERROR\");\r\n//       throw error;\r\n//     }\r\n//   },\r\n\r\n//   async logout({ commit }) {\r\n//     try {\r\n//       await axiosAuth.post(\"/api/method/logout\");\r\n//     } catch (error) {\r\n//       console.error(\"Logout error:\", error);\r\n//     } finally {\r\n//       commit(\"LOGOUT\");\r\n//     }\r\n//   },\r\n\r\n//   async verifyToken({ state }) {\r\n//     if (!state.token) return false;\r\n    \r\n//     try {\r\n//       const response = await axiosAuth.get(\"/api/method/frappe.auth.get_logged_user\");\r\n//       return !!response.data;\r\n//     } catch (error) {\r\n//       return false;\r\n//     }\r\n//   }\r\n// };\r\n\r\n// export default {\r\n//   namespaced: true,\r\n//   state,\r\n//   getters,\r\n//   mutations,\r\n//   actions,\r\n// };\r\n\r\n\r\n// src/store/modules/auth.js\r\nimport { axiosAuth } from \"@/plugins/axios/axiosAuth\";\r\n\r\nconst state = {\r\n  user: JSON.parse(localStorage.getItem(\"user\")) || null,\r\n  status: \"\", // 'loading', 'success', 'error'\r\n  home_page: localStorage.getItem(\"home_page\") || \"/app/home\",\r\n};\r\n\r\nconst getters = {\r\n  isAuthenticated: (state) => !!state.user,\r\n  authStatus: (state) => state.status,\r\n  currentUser: (state) => state.user,\r\n  homePage: (state) => state.home_page,\r\n  fullName: (state) => state.user?.full_name || null,\r\n};\r\n\r\nconst mutations = {\r\n  AUTH_REQUEST(state) {\r\n    state.status = \"loading\";\r\n  },\r\n  AUTH_SUCCESS(state, { user, home_page }) {\r\n    state.status = \"success\";\r\n    state.user = user;\r\n    state.home_page = home_page || \"/app/home\";\r\n    localStorage.setItem(\"user\", JSON.stringify(user));\r\n    localStorage.setItem(\"home_page\", state.home_page);\r\n  },\r\n  AUTH_ERROR(state) {\r\n    state.status = \"error\";\r\n    state.user = null;\r\n    localStorage.removeItem(\"user\");\r\n    localStorage.removeItem(\"home_page\");\r\n  },\r\n  LOGOUT(state) {\r\n    state.user = null;\r\n    state.home_page = \"/app/home\";\r\n    localStorage.removeItem(\"user\");\r\n    localStorage.removeItem(\"home_page\");\r\n  },\r\n};\r\n\r\nconst actions = {\r\n  // async login({ commit }, credentials) {\r\n  //   commit(\"AUTH_REQUEST\");\r\n\r\n  //   try {\r\n  //     // 1. Make login request - this sets the session cookie\r\n  //   const response =   await axiosAuth.post(\"/api/method/login\", {\r\n  //       usr: credentials.email,\r\n  //       pwd: credentials.password,\r\n  //     });\r\n\r\n      \r\n\r\n  //     const user = {\r\n  //       full_name:  response.full_name,\r\n  //       email: credentials.email,\r\n  //     };\r\n\r\n  //     commit(\"AUTH_SUCCESS\", {\r\n  //       user,\r\n  //       home_page: \"/app/home\"\r\n  //     });\r\n\r\n  //     return user;\r\n  //   } catch (error) {\r\n  //     commit(\"AUTH_ERROR\");\r\n      \r\n  //     let errorMessage = \"Login failed\";\r\n  //     if (error.response) {\r\n  //       if (error.response.data && error.response.data.message) {\r\n  //         errorMessage = typeof error.response.data.message === 'string' \r\n  //           ? error.response.data.message\r\n  //           : error.response.data.message.error || errorMessage;\r\n  //       } else if (error.response.status === 401) {\r\n  //         errorMessage = \"Invalid email or password\";\r\n  //       }\r\n  //     }\r\n      \r\n  //     throw new Error(errorMessage);\r\n  //   }\r\n  // },\r\n\r\n \r\n async login({ commit }, credentials) {\r\n  commit(\"AUTH_REQUEST\");\r\n\r\n  try {\r\n    // 1. Clear existing cookies first (avoid conflicts)\r\n    document.cookie.split(\";\").forEach(cookie => {\r\n      const [name] = cookie.trim().split(\"=\");\r\n      document.cookie = `${name}=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;`;\r\n    });\r\n\r\n    // 2. Make login request - this sets session cookies in response\r\n    const response = await axiosAuth.post(\"/api/method/login\", {\r\n      usr: credentials.email,\r\n      pwd: credentials.password,\r\n    }, {\r\n      withCredentials: true, // Ensure cookies are received\r\n      headers: {\r\n        'X-Frappe-Site-Name': 'mynewsite.local'\r\n      }\r\n    });\r\n\r\n    // 3. Verify session by fetching user details\r\n    const userResponse = await axiosAuth.get(\"/api/method/frappe.auth.get_logged_user\", {\r\n      withCredentials: true\r\n    });\r\n\r\n    // 4. Extract critical cookies from document.cookie\r\n    const cookies = document.cookie.split(';').reduce((cookies, item) => {\r\n      const [name, value] = item.trim().split('=');\r\n      cookies[name] = value;\r\n      return cookies;\r\n    }, {});\r\n\r\n    // 5. Store user data with session verification\r\n    const user = {\r\n      full_name: userResponse.data.message.full_name,\r\n      email: credentials.email,\r\n      session_cookies: { // Store critical cookies for API calls\r\n        sid: cookies.sid,\r\n        system_user: cookies.system_user,\r\n        user_id: cookies.user_id\r\n      }\r\n    };\r\n\r\n    commit(\"AUTH_SUCCESS\", {\r\n      user,\r\n      home_page: response.data.home_page || \"/app/home\"\r\n    });\r\n\r\n    // 6. Configure axiosAuth to use these cookies\r\n    axiosAuth.interceptors.request.use(config => {\r\n      if (cookies.sid) {\r\n        config.headers['Cookie'] = `sid=${cookies.sid}; system_user=${cookies.system_user}; user_id=${cookies.user_id}`;\r\n      }\r\n      return config;\r\n    });\r\n\r\n    return user;\r\n  } catch (error) {\r\n    commit(\"AUTH_ERROR\");\r\n    \r\n    let errorMessage = \"Login failed\";\r\n    if (error.response) {\r\n      if (error.response.data?.exc_type === \"AuthenticationError\") {\r\n        errorMessage = \"Invalid credentials\";\r\n      } else {\r\n        errorMessage = error.response.data?.message?.message || \r\n                      error.response.data?.message ||\r\n                      \"Login error occurred\";\r\n      }\r\n    }\r\n    \r\n    throw new Error(errorMessage);\r\n  }\r\n},\r\n  async logout({ commit }) {\r\n    try {\r\n      await axiosAuth.post(\"/api/method/logout\");\r\n    } catch (error) {\r\n      console.error(\"Logout error:\", error);\r\n    } finally {\r\n      commit(\"LOGOUT\");\r\n    }\r\n  },\r\n\r\n  async verifyAuth({ state, commit }) {\r\n    try {\r\n      const response = await axiosAuth.get(\"/api/method/frappe.auth.get_logged_user\");\r\n      if (response.data && response.data.message) {\r\n        // Update user data if needed\r\n        const userData = response.data.message;\r\n        const updatedUser = {\r\n          ...state.user,\r\n          full_name: userData.full_name || state.user?.full_name,\r\n          user_image: userData.user_image || state.user?.user_image\r\n        };\r\n        \r\n        commit(\"AUTH_SUCCESS\", {\r\n          user: updatedUser,\r\n          home_page: state.home_page\r\n        });\r\n        return true;\r\n      }\r\n      return false;\r\n    } catch (error) {\r\n      if (error.response && error.response.status === 401) {\r\n        commit(\"LOGOUT\");\r\n      }\r\n      return false;\r\n    }\r\n  }\r\n};\r\n\r\nexport default {\r\n  namespaced: true,\r\n  state,\r\n  getters,\r\n  mutations,\r\n  actions,\r\n};"],"mappings":";;;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAGA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAGA;AACA,SAASA,SAAS,QAAQ,2BAA2B;AAErD,MAAMC,KAAK,GAAG;EACZC,IAAI,EAAEC,IAAI,CAACC,KAAK,CAACC,YAAY,CAACC,OAAO,CAAC,MAAM,CAAC,CAAC,IAAI,IAAI;EACtDC,MAAM,EAAE,EAAE;EAAE;EACZC,SAAS,EAAEH,YAAY,CAACC,OAAO,CAAC,WAAW,CAAC,IAAI;AAClD,CAAC;AAED,MAAMG,OAAO,GAAG;EACdC,eAAe,EAAGT,KAAK,IAAK,CAAC,CAACA,KAAK,CAACC,IAAI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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}